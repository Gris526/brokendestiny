<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ruleta Pro ğŸ¯</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body data-theme="light">
  <!-- MenÃºs -->
  <button id="menu-toggle">â˜°</button>
  <button id="gear-toggle">âš™ï¸</button>

  <!-- MenÃº lateral izquierdo -->
  <div class="side-menu" id="sideMenu">
    <h3>ğŸ› MenÃº</h3>
    <button onclick="createNewWheel()">â• Nueva Ruleta</button>
    <button onclick="exportWheel()">ğŸ’¾ Exportar Ruleta</button>
    <button onclick="exportAllWheels()">ğŸ“¦ Exportar Todas</button>
    <button onclick="importWheels()">ğŸ“‚ Importar</button>
    <hr/>
    <h4>ğŸ“‹ Ruletas Guardadas</h4>
    <div id="wheelList"></div>
  </div>

  <!-- MenÃº engranaje derecho -->
  <div class="gear-menu" id="gearMenu">
    <h3>âš™ï¸ ConfiguraciÃ³n</h3>
    <label><input type="checkbox" id="darkModeToggle"> ğŸŒ™ Modo Oscuro</label><br><br>
    <label>ğŸµ Sonido Giro</label><input type="file" onchange="loadSound('spin', this.files[0])"><br>
    <label>ğŸ† Sonido Ganador</label><input type="file" onchange="loadSound('win', this.files[0])"><br>
    <label>ğŸ—‘ Sonido Borrar</label><input type="file" onchange="loadSound('delete', this.files[0])"><br>
    <label>â• Sonido Crear</label><input type="file" onchange="loadSound('create', this.files[0])"><br>
    <label>ğŸ¶ MÃºsica Fondo</label><input type="file" onchange="loadMusic(this.files[0])"><br>
    <button onclick="stopMusic()">â¹ï¸ Detener MÃºsica</button>
  </div>

  <!-- Encabezado -->
  <div class="header">
    <input type="text" id="emojiInput" placeholder="ğŸ¯" maxlength="2" />
    <input type="text" id="nameInput" placeholder="Nombre de la Ruleta" />
    <button onclick="toggleFullscreen()">ğŸ–¥ï¸ Vista Completa</button>
  </div>
  <h1 id="wheelTitle">ğŸ¯ Ruleta Pro</h1>

  <!-- Contenido principal -->
  <div class="main">
    <!-- Panel izquierdo -->
    <div class="panel left-panel">
      <textarea id="optionInput" placeholder="Usa -CategorÃ­a-\nEj: -Comida-\nPizza:3\nEnsalada:1"></textarea>
      <button onclick="addOptions()">Agregar Opciones</button>
      <button onclick="clearAll()">ğŸ§¹ Borrar Todo</button>
      <h4>CategorÃ­as</h4>
      <ul id="categories"></ul>
    </div>

    <!-- Panel derecho con ruleta -->
    <div class="panel right-panel">
      <canvas id="wheel" width="400" height="400"></canvas>
      <button onclick="spinWheel()">ğŸ¯ Girar</button>
      <p id="result"></p>
    </div>
  </div>
<script>
let options = [];
let categories = {};
let wheels = [];
let currentRotation = 0;
let lastWinnerIndex = -1;
let sounds = {};
let music = null;

const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const resultEl = document.getElementById('result');

const emojiInput = document.getElementById('emojiInput');
const nameInput = document.getElementById('nameInput');
const wheelTitle = document.getElementById('wheelTitle');

emojiInput.oninput = updateTitle;
nameInput.oninput = updateTitle;

function updateTitle() {
  wheelTitle.textContent = `${emojiInput.value || 'ğŸ¯'} ${nameInput.value || 'Ruleta Pro'}`;
}

function toggleFullscreen() {
  document.querySelector('.left-panel').classList.toggle('hidden');
}

document.getElementById('menu-toggle').onclick = () => {
  document.getElementById('sideMenu').classList.toggle('open');
};

document.getElementById('gear-toggle').onclick = () => {
  document.getElementById('gearMenu').classList.toggle('open');
};

document.getElementById('darkModeToggle').onchange = e => {
  document.body.dataset.theme = e.target.checked ? 'dark' : 'light';
};

function playSound(type) {
  if (sounds[type]) {
    const s = sounds[type].cloneNode();
    s.play();
  }
}

function loadSound(type, file) {
  const url = URL.createObjectURL(file);
  const audio = new Audio(url);
  sounds[type] = audio;
}

function loadMusic(file) {
  if (music) music.pause();
  music = new Audio(URL.createObjectURL(file));
  music.loop = true;
  music.volume = 0.5;
  music.play();
}

function stopMusic() {
  if (music) music.pause();
}

function createNewWheel() {
  const name = nameInput.value.trim() || "Ruleta";
  const emoji = emojiInput.value.trim() || "ğŸ¯";
  wheels.push({ name, emoji, options: [], categories: {} });
  updateWheelListUI();
  clearAll();
  playSound("create");
}

function updateWheelListUI() {
  const container = document.getElementById('wheelList');
  container.innerHTML = "";
  wheels.forEach((w, i) => {
    const item = document.createElement('div');
    item.className = "wheel-list-item";
    item.innerHTML = `
      <span onclick="loadWheel(${i})" style="cursor:pointer;">${w.emoji} ${w.name}</span>
      <button onclick="deleteWheel(${i})">ğŸ—‘ï¸</button>`;
    container.appendChild(item);
  });
}

function loadWheel(i) {
  const w = wheels[i];
  emojiInput.value = w.emoji;
  nameInput.value = w.name;
  options = JSON.parse(JSON.stringify(w.options));
  categories = JSON.parse(JSON.stringify(w.categories));
  updateTitle();
  updateCategoryList();
  drawWheel();
  updateOptionsList();
}

function deleteWheel(i) {
  if (confirm("Â¿Eliminar esta ruleta?")) {
    wheels.splice(i, 1);
    updateWheelListUI();
    playSound("delete");
  }
}

function addOptions() {
  const input = document.getElementById("optionInput").value.trim();
  if (!input) return;
  const lines = input.split("\n");
  let currentCat = "Default";
  if (!categories[currentCat]) categories[currentCat] = { color: randomColor(), active: true };

  for (const line of lines) {
    if (/^-\w.*-$/.test(line)) {
      currentCat = line.slice(1, -1).trim();
      if (!categories[currentCat]) categories[currentCat] = { color: randomColor(), active: true };
      continue;
    }
    const [text, weightStr] = line.split(":");
    options.push({ text: text.trim(), weight: parseFloat(weightStr) || 1, category: currentCat });
  }

  drawWheel();
  updateOptionsList();
  updateCategoryList();
}

function clearAll() {
  if (!confirm("Â¿Borrar todas las opciones?")) return;
  options = [];
  categories = {};
  drawWheel();
  updateCategoryList();
  updateOptionsList();
  playSound("delete");
}

function updateOptionsList() {
  // future expansion: editable list
}

function updateCategoryList() {
  const list = document.getElementById('categories');
  list.innerHTML = "";
  for (const c in categories) {
    const li = document.createElement("li");
    li.innerHTML = `
      <label><input type="checkbox" ${categories[c].active ? "checked" : ""} onchange="toggleCategory('${c}')"> ${c}</label>
      <input type="color" value="${categories[c].color}" onchange="changeCategoryColor('${c}', this.value)" />
    `;
    list.appendChild(li);
  }
}

function toggleCategory(cat) {
  categories[cat].active = !categories[cat].active;
  drawWheel();
}

function changeCategoryColor(cat, val) {
  categories[cat].color = val;
  drawWheel();
}

function randomColor() {
  return '#' + Math.floor(Math.random() * 0xffffff).toString(16).padStart(6, '0');
}
</script>
<style>
:root {
  --bg: #fdfdfd;
  --text: #111;
  --panel: #ffffff;
  --border: #ccc;
}

[data-theme="dark"] {
  --bg: #121212;
  --text: #eee;
  --panel: #1e1e1e;
  --border: #444;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Segoe UI', sans-serif;
  margin: 0;
  padding: 0;
  transition: background 0.3s, color 0.3s;
}

button {
  cursor: pointer;
}

h1 {
  text-align: center;
  margin: 0.5rem 0;
}

.header {
  display: flex;
  gap: 0.5rem;
  justify-content: center;
  flex-wrap: wrap;
  align-items: center;
  margin: 1rem 0 0;
}

.header input {
  font-size: 1.2rem;
  padding: 0.2rem 0.6rem;
}

.main {
  display: flex;
  gap: 2rem;
  justify-content: center;
  flex-wrap: wrap;
  padding: 1rem;
}

.panel {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 1rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.left-panel {
  width: 320px;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  transition: all 0.3s ease;
}

.left-panel.hidden {
  display: none;
}

.right-panel {
  display: flex;
  flex-direction: column;
  align-items: center;
}

textarea {
  font-size: 1rem;
  padding: 0.5rem;
  width: 100%;
  height: 120px;
  resize: vertical;
}

canvas {
  border-radius: 50%;
  background: var(--panel);
  border: 3px solid var(--border);
}

#result {
  margin-top: 1rem;
  font-weight: bold;
  font-size: 1.2rem;
}

#categories {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

#categories li {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.side-menu,
.gear-menu {
  position: fixed;
  top: 0;
  width: 260px;
  height: 100vh;
  background: var(--panel);
  border-left: 1px solid var(--border);
  box-shadow: -2px 0 6px rgba(0,0,0,0.2);
  overflow-y: auto;
  padding: 1rem;
  z-index: 1000;
  transform: translateX(-100%);
  transition: transform 0.3s ease;
}

.side-menu {
  left: 0;
  transform: translateX(-100%);
}
.side-menu.open {
  transform: translateX(0);
}

.gear-menu {
  right: 0;
  transform: translateX(100%);
}
.gear-menu.open {
  transform: translateX(0);
}

#menu-toggle, #gear-toggle {
  position: fixed;
  top: 10px;
  background: none;
  border: none;
  font-size: 24px;
  color: var(--text);
  z-index: 1100;
}

#menu-toggle {
  left: 10px;
}

#gear-toggle {
  right: 10px;
}

.wheel-list-item {
  display: flex;
  justify-content: space-between;
  background: #ddd;
  padding: 0.4rem 0.6rem;
  margin-bottom: 4px;
  border-radius: 4px;
}
.wheel-list-item button {
  background: #ff4444;
  border: none;
  color: white;
  padding: 0.2rem 0.6rem;
  cursor: pointer;
}

@media (max-width: 600px) {
  canvas {
    width: 300px;
    height: 300px;
  }
}
</style>
